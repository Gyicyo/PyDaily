[TOC]



**åªæ¶‰åŠç›¸å¯¹ç®€å•çš„éƒ¨åˆ†ï¼Œå…·ä½“å†…å®¹å‚è€ƒæ–‡æ¡£**

----

**â€œè·å–æ•°æ®â€”â€”è§£ææ•°æ®â€”â€”å­˜å‚¨æ•°æ®â€**æ˜¯çˆ¬è™«çš„ä¸‰éƒ¨æ›²ï¼Œå¤§éƒ¨åˆ†çˆ¬è™«éƒ½æ˜¯æŒ‰è¿™æ ·çš„æµç¨‹æ¥è¿›è¡Œï¼Œè¿™å…¶å®ä¹Ÿæ˜¯æ¨¡æ‹Ÿäº†æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨è·å–ç½‘é¡µä¿¡æ¯çš„è¿‡ç¨‹ã€‚

### è·å–æ•°æ®

â€‹		**çˆ¬è™«ç¬¬ä¸€æ­¥æ“ä½œå°±æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€è¯·æ±‚**ï¼ŒåŸºäºpythonï¼Œä½ ä¸éœ€è¦äº†è§£ä»æ•°æ®çš„å®ç°ï¼ŒHTTPã€TCPã€IPçš„ç½‘ç»œä¼ è¾“ç»“æ„ï¼Œä¸€ç›´åˆ°æœåŠ¡å™¨å“åº”å’Œåº”ç­”çš„åŸç†ï¼Œå› ä¸º**pythonæä¾›äº†åŠŸèƒ½é½å…¨çš„ç±»åº“æ¥å¸®æˆ‘ä»¬å®Œæˆè¿™äº›è¯·æ±‚ã€‚**

pythonæä¾›çš„ç±»åº“æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸¾å¸¸ç”¨çš„ä¾‹å­ä»‹ç»



---------------------------------------



#### urllib3

å®˜æ–¹ä½¿ç”¨æ–‡æ¡£ï¼š[User Guide - urllib3 2.1.0 documentation](https://urllib3.readthedocs.io/en/stable/user-guide.html)

##### PoolManager

â€‹	ä½¿ç”¨urllib3å‘é€ç½‘ç»œè¯·æ±‚æ—¶ï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºPoolManagerå¯¹è±¡ï¼Œå†é€šè¿‡è¯¥å¯¹è±¡è°ƒç”¨ **request()** æ–¹æ³•å‘é€è¯·æ±‚ã€‚

```python
urllib3.disable_warnings() #å…³é—­sslè­¦å‘Š
http = urllib3.PoolManager()
```

PoolManageræœ‰å¾ˆå¤šå¯é€‰å‚æ•°ï¼š

- `num_pools`ï¼šæŒ‡å®šè¿æ¥æ± çš„æ•°é‡ï¼Œé»˜è®¤ä¸º 10ã€‚è¿æ¥æ± æ•°é‡å†³å®šäº†å¯ä»¥åŒæ—¶ä¿æŒå¤šå°‘ä¸ª**åŸŸå**è¿æ¥ã€‚
- `maxsize`ï¼šæŒ‡å®šæ¯ä¸ªè¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º Noneï¼Œè¡¨ç¤ºä¸é™åˆ¶ã€‚å¦‚æœè®¾ç½®ä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œåˆ™ä¼šé™åˆ¶æ¯ä¸ªè¿æ¥æ± çš„æœ€å¤§è¿æ¥æ•°ã€‚
- `block`ï¼šå½“è¿æ¥æ± ä¸­æ²¡æœ‰å¯ç”¨è¿æ¥æ—¶ï¼Œæ˜¯å¦é˜»å¡ç­‰å¾…ï¼Œé»˜è®¤ä¸º Falseã€‚å¦‚æœè®¾ç½®ä¸º Trueï¼Œåˆ™åœ¨è¿æ¥æ± å æ»¡æ—¶ï¼Œè¯·æ±‚ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨è¿æ¥ä¸ºæ­¢ã€‚å¦‚æœè®¾ç½®ä¸º Falseï¼Œåˆ™åœ¨è¿æ¥æ± å æ»¡æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚
- `timeout`ï¼šè®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º Noneï¼Œè¡¨ç¤ºä¸é™åˆ¶ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªæµ®ç‚¹æ•°ï¼ŒæŒ‡å®šè¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚
- `retries`ï¼šè®¾ç½®é‡è¯•é‡å®šå‘æ¬¡æ•°ï¼Œé»˜è®¤ä¸º 3ã€‚å½“å‘èµ·è¯·æ±‚æ—¶ï¼Œå¦‚æœå‡ºç°è¿æ¥é”™è¯¯æˆ–è¶…æ—¶ï¼Œä¼šè‡ªåŠ¨è¿›è¡Œä¸€å®šæ¬¡æ•°çš„é‡è¯•ã€‚
- `headers`ï¼šè¯·æ±‚å¤´å‚æ•°ï¼Œé»˜è®¤ä¸ºç©ºå­—å…¸ã€‚è‹¥è®¾ç½®ï¼Œåˆ™ä¹‹åçš„è¯·æ±‚é»˜è®¤åŠ å…¥è¿™äº›header

###### è¿æ¥æ± 

â€‹		è¿æ¥æ± ï¼ˆConnection Poolï¼‰æ˜¯ä¸€ç§ç¼“å­˜æŠ€æœ¯ï¼Œç”¨äºé‡å¤åˆ©ç”¨å·²å»ºç«‹çš„è¿æ¥ï¼Œä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå¯ä¼¸ç¼©æ€§ã€‚è¿æ¥æ± é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„è¿æ¥ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œä»¥å¤‡åç»­ä½¿ç”¨ï¼Œé¿å…äº†æ¯æ¬¡è¯·æ±‚éƒ½é‡æ–°å»ºç«‹è¿æ¥çš„å¼€é”€ã€‚

**num_pools**

æŒ‡å®šæ± å­çš„æ•°é‡, å‡å¦‚æœ‰10ä¸ªæ± å­, å½“ä½ è®¿é—®ç¬¬11ä¸ªåŸŸåçš„æ—¶å€™ç¬¬ä¸€ä¸ªæ± å­ä¼šè¢«å¹²æ‰, ç„¶åå»ºä¸€ä¸ªæ–°çš„ä¾›ç¬¬11ä¸ªä½¿ç”¨.ä¸€ä¸ªæ± å­æ˜¯ä½œç”¨äºåŒä¸€ä¸ªåŸŸåä¸‹çš„, å³http://aaa.com/aå’Œhttp://aaa.com/bæ˜¯ä¼šå…±ç”¨ä¸€ä¸ªæ± å­çš„



**maxsize**

æŒ‡å®šä¸€ä¸ªæ± å­ç¼“å­˜çš„æœ€å¤§è¿æ¥æ•°é‡.æ²¡æœ‰è¶…è¿‡æœ€å¤§é“¾æ¥æ•°é‡çš„é“¾æ¥éƒ½ä¼šè¢«ä¿å­˜ä¸‹æ¥.åœ¨blockä¸ºfalseçš„æƒ…å†µä¸‹,             æ·»åŠ çš„é¢å¤–çš„é“¾æ¥ä¸ä¼šè¢«ä¿å­˜ä¸€èˆ¬å¤šç”¨äºå¤šçº¿ç¨‹ä¹‹ä¸‹, ä¸€èˆ¬æƒ…å†µæ˜¯è®¾ç½®ä¸ºå’Œçº¿ç¨‹æ•°ç›¸ç­‰çš„æ•°é‡, ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½è®¿é—®ä¸€ä¸ªé“¾æ¥. 



##### å‘é€è¯·æ±‚

â€‹		urllib3å‘é€è¯·æ±‚å¯ä»¥ä½¿ç”¨urlopenå’Œrequestï¼Œä¸€èˆ¬ç”¨request

```python
request(method,url,fields=None,headers=None)
```

- `method` å¿…é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šè¯·æ±‚æ–¹å¼ï¼Œå¦‚GETï¼ŒPOSTï¼ŒPUTç­‰ã€‚
- `url` å¿…é¡»æŒ‰å‚æ•°ï¼Œè¦è®¿é—®çš„url
- `fields` å¯é€‰å‚æ•°ï¼Œè®¾ç½®è¯·æ±‚çš„å‚æ•°
- `headers` å¯é€‰å‚æ•°ï¼Œè¯·æ±‚å¤´

åŒæ ·ä¹Ÿå¯ä»¥è®¾ç½®timeoutã€retriesç­‰



##### å“åº”å†…å®¹

###### å“åº”å¤´

å¯ä»¥é€šè¿‡infoï¼ˆï¼‰æ–¹æ³•è·å–å“åº”å¤´ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·å–

```python
response = poolManager.request()
response_headers = response.info()#å¾—åˆ°ä¸€ä¸ªå“åº”å¤´å­—å…¸
response_headers = response.headers#åŒä¸Š
```

###### JSON

å¯¼å…¥jsonæ¨¡å—å°†JSONæ ¼å¼è½¬åŒ–ä¸ºå­—å…¸

```python
json.loads(response.data.decode('unicode_escape')) # unicode_escapeå¤„ç†ä¸­æ–‡
```



###### äºŒè¿›åˆ¶æ ¼å¼

è¿™ç§ä¸€èˆ¬å°±æ˜¯å›¾ç‰‡ï¼Œä¸¾ä¸ªä¾‹å­

```python
import urllib3

url = 'https://www.bing.com/red-dot-24.png'
http = urllib3.PoolManager()
response = http.request('GET', url)
f = open('red-dot-24.png', 'wb')#wbæ˜¯ä»¥äºŒè¿›åˆ¶æ ¼å¼å†™å…¥æ¨¡å¼æ‰“å¼€æ–‡ä»¶
f.write(response.data)#å†™å…¥æ•°æ®
f.close()#å…³é—­æ–‡ä»¶
```



##### ä¸Šä¼ å†…å®¹

å°†æ–‡ä»¶è½¬åŒ–ä¸ºdataåä¸Šä¼ 

ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§ä¼ fieldsï¼Œä¸€ç§ä¼ body

fieldsåªé€‚åˆä¸Šä¼ å°è§„æ¨¡ã€ä¸æ¶‰åŠæ•æ„Ÿä¿¡æ¯çš„æ–‡æœ¬

bodyæ›´é€‚åˆä¼ è¾“å¤§è§„æ¨¡ä¼ è¾“ï¼Œç»™ä»¥ä¼ è¾“æ›´å¤šç±»å‹çš„æ•°æ®

###### æ–‡æœ¬ä¸Šä¼ 

```python
#fields
url = 'http://httpbin.org/post'
with open('Person.txt','r') as f : # åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æµ
    data = f.read()
response = http.request('POST',url,fields={'filefield':('Person',data,'txt')})
print(response.data.decode())

#body
url = 'http://httpbin.org/post'
with open('Person.txt','r') as f :
    data = f.read()
response = http.request('POST',url,body = data)
print(response.data.decode())
```



###### JSON

```python
url = 'http://httpbin.org/post'
params = json.dumps({'name':'æ°å…‹','age':'23'})
response = http.request('POST',url,body=params)#è¿™é‡Œbodyä¹Ÿå¯ä»¥æ›¿æ¢æˆjson
print(response.data.decode('unicode_escape'))
```



###### å›¾ç‰‡ä¸Šä¼ 

ç±»ä¼¼æ–‡æœ¬ï¼Œä½†éœ€è¦è¡¨æ˜è¯·æ±‚å¤´Content-Type

```python
url = 'http://httpbin.org/post'
with open('red-dot-24.png','rb') as f :
    data = f.read()
response = http.request('POST',url,body=data,headers={'Content-Type':'image/jpeg'})
print(response.data.decode())
```

###### cookies

urllib3ä¸Šä¼ cookieè¦æŠŠcookieæ·»åŠ åœ¨è¯·æ±‚å¤´ä¸­

ç›¸åº”çš„ï¼Œè¿”å›çš„cookieä»å“åº”å¤´ä¸­è·å–

```python
header = {'cookie':'work'}

response = http.request()
cookie = response.headers
```



##### ä»£ç†

è®¾ç½®ä»£ç†IPéœ€è¦åˆ›å»ºProxyManagerå¯¹è±¡ï¼Œè¯¥å¯¹è±¡éœ€è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼›proxy_urlè¡¨ç¤ºéœ€è¦ä½¿ç”¨çš„ä»£ç†IPï¼Œheaderså³è¯·æ±‚å¤´ã€‚

```python
proxy = urllib3.ProxyManager('xxxxxxxxxxxx', headers=headers)
r = proxy.request('get', url)  # å‘é€è¯·æ±‚
```



---------------------------------------



#### requests

â€‹		`requests` è¢«è®¾è®¡ä¸ºæ›´åŠ ç®€æ´å’Œæ˜“ç”¨çš„ HTTP åº“ã€‚å®ƒæä¾›äº†ç®€æ´çš„ APIï¼Œæ˜“äºå­¦ä¹ å’Œä½¿ç”¨ã€‚`requests` çš„ç›®æ ‡æ˜¯æä¾›ä¸€ç§ç›´è§‚å’Œæ–¹ä¾¿çš„æ–¹å¼æ¥æ‰§è¡Œå„ç§ HTTP è¯·æ±‚ï¼Œå¹¶åœ¨èƒŒåå¤„ç†è®¸å¤šç»†èŠ‚ã€‚

`requests` åˆ©ç”¨äº† `urllib3` æä¾›çš„åº•å±‚ HTTP è¿æ¥å’Œç»†èŠ‚ï¼ŒåŒæ—¶æä¾›äº†æ›´ç®€æ´ã€æ›´é«˜çº§çš„ APIï¼Œä½¿å¾—å‘é€ HTTP è¯·æ±‚å˜å¾—æ›´åŠ å®¹æ˜“ã€‚

å®˜æ–¹æ–‡æ¡£ï¼š[Quickstart â€” Requests 2.31.0 documentation](https://requests.readthedocs.io/en/latest/user/quickstart/)

â€‹		ä½¿ç”¨requestséå¸¸ç®€ä¾¿

```python
import requests

url = 'https://httpbin.org/get'
response = requests.get(url)

url = 'https://httpbin.org/post'
r = requests.post(url,data={'key':'value'})

r = requests.put('https://httpbin.org/put', data={'key': 'value'})
r = requests.delete('https://httpbin.org/delete')
r = requests.head('https://httpbin.org/get')
r = requests.options('https://httpbin.org/get')
r.encoding = 'unicode_escape'#è§£ç æ ¼å¼æ”¹ä¸ºunicode_escapeæ¥å¤„ç†ä¸­æ–‡
print(r.text) #è·å–è§£ç åçš„å“åº”å†…å®¹
print(r.content)#è·å–åŸå§‹å†…å®¹ 

r = requests.get(url,params={'key':'value'})#paramsä¼šä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²æ·»åŠ åˆ°urlä¸Š
print(r.url)#è·å–url

r = requests.get(url,timeout=1)#è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œä¸è®¾ç½®åˆ™é»˜è®¤ä¸ä¼šè¶…æ—¶ã€‚
#æ³¨æ„ï¼šè¶…æ—¶æŒ‡çš„ä¸æ˜¯æ•´ä¸ªè¯·æ±‚è¿‡ç¨‹èŠ±è´¹æ—¶é—´ï¼Œè€Œæ˜¯åœ¨è®¾ç½®çš„è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä¼ æ¥çš„å­—èŠ‚æ—¶è®¤å®šè¶…æ—¶
```

##### paramsæ³¨æ„äº‹é¡¹

- ä»»ä½•ä¸ºç©ºçš„valueå€¼éƒ½ä¸ä¼šæ·»åŠ åˆ°urlä¸­

- é’ˆå¯¹åŒä¸€ä¸ªkeyï¼Œå¯ä»¥ä¸Šä¼ å¤šä¸ªvalueï¼Œé€šè¿‡åˆ—è¡¨çš„å½¢å¼

  ```python
  payload = {'key1': 'value1', 'key2': ['value2', 'value3']}
  r = requests.get('https://httpbin.org/get', params=payload)
  print(r.url)
  #result:
  #https://httpbin.org/get?key1=value1&key2=value2&key2=value3
  ```

##### textå’Œ contentçš„åŒºåˆ«

**text**ä¼šè‡ªåŠ¨å¯¹å“åº”å†…å®¹è¿›è¡Œé»˜è®¤ä¸º**â€˜utf-8â€™**æ ¼å¼çš„è§£ç ï¼Œè€Œ**content**ä¸ä¼šå¯¹å“åº”å†…å®¹è¿›è¡Œä»»ä½•æ›´æ”¹

å¦‚æœå“åº”å†…å®¹ä¸º**HTMLã€JSON**ç­‰ï¼Œ**text**æ›´å¥½

å¦‚æœå“åº”å†…å®¹ä¸º**å›¾ç‰‡ç­‰äºŒè¿›åˆ¶**å†…å®¹ï¼Œä½¿ç”¨**content**æ¥è·å–å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®

ä¾‹å¦‚ï¼Œä»¥ä¸‹ä¸ºè¯·æ±‚å›¾ç‰‡å†…å®¹æ—¶textå’Œcontentçš„æ•°æ®å¯¹æ¯”ï¼ˆä¸Šéƒ¨åˆ†ä¸ºtextï¼Œä¸‹éƒ¨åˆ†ä¸ºcontentï¼‰

```python
ï¿½ï¿½ï¿½ï¿½ JFIF      ï¿½ï¿½!ï¿½ICC_PROFILE   !ï¿½NKON   mntrRGB XYZ ï¿½     
 !#$&')*,./124679:<>?ACDFGIKLNPQSUWXZ\]_acdfhjkmoqrtvxz{}ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½

b'\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x00\x00\x01\x00\x01\x00\x00\xff\xe2!\xfcICC_PROFILE\x00\x01\x01\x00\x00!\xecNKON\x02 \x00\x00mntrRGB XYZ \x07\xd9\x00\x02\x00\x14\x00\x11\x00\x07\x00\nacspAPPL\x00\x00\x00\x00none\x00\x00\x00\x01\x00\x00\x0
```

contentæ•°æ®ä»¥b'å¼€å¤´ï¼Œè¡¨ç¤ºæ˜¯äºŒè¿›åˆ¶æ•°æ®

##### JSON

â€‹	requestsæœ‰å†…ç½®jsonè§£ç å™¨

```python
r = requests.get(url)
r.json()
```

å¦‚æœè¿”å›å†…å®¹ä¸æ˜¯JSONæ ¼å¼ï¼Œåˆ™ä¼šæŠ¥é”™

éœ€è¦ä¸Šä¼ JSONæ ¼å¼çš„è¯

```python
data = {'key':'value'}
r = requests.post(url,json=data)
```

**æ³¨æ„:**å¦‚æœä¸Šä¼ jsonåŒæ—¶ä¸Šä¼ äº†dataæˆ–filesï¼Œjsonä¼šè¢«å¿½ç•¥

##### cookies

ä¸Šä¼ cookie

```python
url = 'https://httpbin.org/cookies'
cookies = dict(cookies_are='working')

r = requests.get(url, cookies=cookies)
print(r.text)
```



-----

##### æ–‡ä»¶

â€‹		requestsä¸Šä¼ æ–‡ä»¶éå¸¸ç®€ä¾¿

```python
url = 'https://httpbin.org/post'
files = {'file':open('person.txt','rb')}
r = requests.post(url,files=files)


#è¿˜å¯ä»¥ç›´æ¥ç¼–è¾‘éœ€è¦ä¸Šä¼ çš„å†…å®¹
url = 'https://httpbin.org/post'
files = {'file':('c.txt','some data to send')}
r = requests.post(url,files=files)

#å›¾ç‰‡
url = 'https://httpbin.org/post'
files = {'image':('test.png',open('test.png','rb'),'image/png')}
```

**æ³¨æ„ï¼š**åœ¨requestsçš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰å¦‚ä¸‹è­¦å‘Šï¼š

It is strongly recommended that you open files in [binary mode](https://docs.python.org/3/tutorial/inputoutput.html#tut-files). This is because Requests may attempt to provide the `Content-Length` header for you, and if it does this value will be set to the number of *bytes* in the file. Errors may occur if you open the file in *text mode*.

å› æ­¤åœ¨æ‰“å¼€æ–‡ä»¶è¿›è¡Œä¸Šä¼ æ—¶å°½é‡ä»¥rbæ–¹å¼æ‰“å¼€

##### å“åº”å†…å®¹

######  å“åº”çŠ¶æ€ç 

```python
code = r.status_code # 200,304...

#requestså†…ç½®äº†å„ç§è¯·æ±‚çŠ¶æ€ç 
if code = requests.codes.ok:
    print('ok')


try:
    r.raise_for_status()
    # å¦‚æœæ²¡æœ‰å¼‚å¸¸ï¼Œç»§ç»­å¤„ç†æ­£å¸¸å“åº”
    print("ok")
except requests.exceptions.HTTPError as err:
    # å¤„ç† HTTP é”™è¯¯
    print(err)

#è¯¥æ–¹æ³•ä¼šæ£€æŸ¥æ˜¯å¦è¯·æ±‚å¤±è´¥
```

###### å“åº”å¤´

```python
headers = r.headers # è¿”å›headerå­—å…¸
```

###### cookies

å¦‚æœè¯·æ±‚ç»“æœä¸­åŒ…å«äº†cookiesï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•è·å–

```python
cookieJar = r.cookies
```

ç”¨å¦‚ä¸‹æ–¹æ³•ä¸Šä¼ cookieé”®å€¼å¯¹

```python
myCookie = {'cookie_name':'value'}
requests.get(url,cookies=myCookie)
```

å½“ç„¶ï¼Œrequestsæ˜¯åœ¨urllib3åŸºç¡€ä¸Šå»ºç«‹çš„ï¼Œä¹Ÿå¯ä»¥åœ¨headerä¸Šç›´æ¥ä¸Šä¼ cookie



##### é‡å®šå‘

requestsä¼šè‡ªåŠ¨å¤„ç†headè¯·æ±‚å¤–çš„æ‰€æœ‰é‡å®šå‘

```python
history = response.history # è·å–æ‰€æœ‰responseçš„list,ä»æœ€æ—©çš„å“åº”åˆ°æœ€è¿‘çš„å“åº”

r = requests.get('http://github.com/', allow_redirects=False) # ç¦ç”¨é‡å®šå‘

r = requests.head('http://github.com/', allow_redirects=True)#headè¯·æ±‚é‡å®šå‘éœ€è¦è‡ªè¡Œå¯ç”¨
```



-----

#### å…³äºurllib3å’Œrequestsçš„cookieä¸Šä¼ 

æ³¨æ„åˆ°urllib3ä¸Šä¼ cookieç›´æ¥åœ¨è¯·æ±‚å¤´ä¸­ä»¥keyä¸ºCookieï¼Œå€¼ä¸ºvalueçš„å½¢å¼ä¸Šä¼ ï¼Œè€Œrequestsä¸Šä¼ cookieå¯ä»¥ä¸Šä¼ å­—å…¸ï¼Œè€Œå­—å…¸ä¸­åŒ…å«ä¸€ä¸ªcookie_nameã€‚

**cookie**æ˜¯ç”±ä¸€ç³»åˆ—çš„é”®å€¼å¯¹ç»„æˆçš„ï¼Œä¸¾ä¸ªä¾‹å­

```
MUID=33C3DEA78AE06D390BD2CDBD8B866C50; SRCHD=AF=NOFORM; SRCHUID=V=2&GUID=373FF788DD824FD7A3560E5193705AB0&dmnchg=1; MUIDB=33C3DEA78AE06D390BD2CDBD8B866C50; PPLState=1;
```

åˆ†å·åˆ’åˆ†æ¯ä¸ªé”®å€¼å¯¹ï¼ŒMUIDå³ä¸ºcookie_name,33C3DEA78AE06D390BD2CDBD8B866C50å³ä¸ºvalueã€‚

requestsçš„çš„cookieä¸Šä¼ çš„å­—å…¸å¯ä»¥åŒ…å«å¤šä¸ªé”®å€¼å¯¹ï¼Œåœ¨è¯·æ±‚æ—¶å°†ä¼šè‡ªåŠ¨å¤„ç†ååŠ å…¥headerä¸­

ä¹Ÿå°±æ˜¯è¯´

```python
http.request(method='get',header={'Cookie':'id=1;name=Jack'})

requests.get(url,cookies={'id':1,'name':'Jack'})
```

ä½œç”¨ç›¸åŒ



---



#### ä½¿ç”¨requestsçˆ¬å–ccnuä¸€ç«™å¼å¹³å°è·å–ç”¨æˆ·ä¿¡æ¯

```python
import requests
import re
import time
from datetime import datetime
import User

s = requests.Session()


headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0',
}
url = 'https://account.ccnu.edu.cn/cas/login'

s.headers = headers
data = {'username':User.id,
        'password':User.password,
        '_eventId':'submit',
        'submit':'ç™»å½•',
        'execution':'',
        'lt':''
        }

r = s.get(url,params={'service':'http://one.ccnu.edu.cn/cas/login_portal'})
ltText = r.text
lt = re.search(r'<input type="hidden" name="lt" value="(.*?)" />',ltText)

execution = re.search(r'<input type="hidden" name="execution" value="(.*?)" />',ltText)
print(execution.group(1))
params = {'service':'http://one.ccnu.edu.cn/cas/login_portal'}

data.update({'lt':lt.group(1)})
data.update({'execution':execution.group(1)})

s.cookies.update({'CASPRIVACY':'', 'CASTGC':''})
r = s.post(url,data=data,params=params,allow_redirects=True)

timestamp_milliseconds = int(datetime.now().timestamp() * 1000)

data = {'limit':'10','page':'1','tranType':'','start':'2023-11-18','end':'2023-11-24'}
s.headers.update({'Authorization':f'Bearer {s.cookies["PORTAL_TOKEN"]}'})
r = s.post('http://one.ccnu.edu.cn/user_portal/index')
print(r.text)
```



#### çˆ¬æ•™åŠ¡ç®¡ç†ç³»ç»Ÿ

```python
import requests
import re
import time
from datetime import datetime
import User

s = requests.Session()


headers = {
    'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 Edg/119.0.0.0',
}
url = 'https://account.ccnu.edu.cn/cas/login'

s.headers = headers
data = {'username':User.id,
        'password':User.password,
        '_eventId':'submit',
        'submit':'ç™»å½•',
        'execution':'',
        'lt':''
        }

# ä¸ä¸€ç«™å¼å”¯ä¸€ä¸åŒçš„å°±æ˜¯service
r = s.get(url,params={'service':'http://xk.ccnu.edu.cn/sso/pziotlogin'})
ltText = r.text
lt = re.search(r'<input type="hidden" name="lt" value="(.*?)" />',ltText)

execution = re.search(r'<input type="hidden" name="execution" value="(.*?)" />',ltText)
print(execution.group(1))

data.update({'lt':lt.group(1)})
data.update({'execution':execution.group(1)})

s.cookies.update({'CASPRIVACY':'', 'CASTGC':''})
r = s.post(url,data=data,params={'service':'http://xk.ccnu.edu.cn/sso/pziotlogin'},allow_redirects=True)

print(r.status_code)
print(r.headers)
print(s.headers)
for p in r.history:
        print(p.url)
        print(p.headers)

print(s.cookies)
# è·å–åˆ°tokenå’Œjsessionidï¼Œå°±èƒ½çˆ¬å¹³æ—¶æˆç»©ã€é€‰è¯¾ã€è€ƒè¯•å®‰æ’ä¹‹ç±»çš„
```

