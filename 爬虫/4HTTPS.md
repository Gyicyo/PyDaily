HTTPS即HTTP+SSL，相较于HTTP请求，HTTPS使用了SSL/TLS(TLS继任SSL)加密，相关请求和抓取都会更加复杂

关于HTTPS是什么，参考**[HTTPS - 维基百科，自由的百科全书 (wikipedia.org)](https://en.wikipedia.org/wiki/HTTPS)**

[TOC]



#### 抓取HTTPS请求



###### HTTPS抓包流程

​	由于HTTPS数据会加密后传输，因此不能像HTTP一样直接获取数据，需要一些操作，具体步骤如下：

1. 获取抓包软件的证书
2. 将证书导入到浏览器或系统证书，具体参考《抓取工具》的参考资料
3. 重启浏览器和抓包软件
4. 完成

​	到这里抓包软件就能获取HTTPS请求了



###### HTTPS抓包的工作机制



​	首先，要了解[证书](# 证书)



​	从证书的工作机制可以看出，要想抓包HTTPS，需要先进行数据解密，也因此必须获取到客户端和服务器协商后的密钥。抓包软件的**代理证书**正是用来获取这个密钥的。

抓包HTTPS过程如下：

​	首先，抓包软件会拦截HTTPS请求，抓包软件会使用自己的代理证书来响应客户端的证书请求，这时，由于之前将抓包软件的证书导入到了浏览器或系统中，客户端会信任其代理证书，从而与抓包软件建立安全连接并协商生成密钥。

​	然后，由于抓包软件在拦截HTTPS请求时获取到了真实服务器的证书，因此会与真实服务器也建立连接并协商密钥

​	最后，抓包软件与服务端和客户端均建立了连接，同时知道两个连接密钥，能在保证数据安全的前提下对数据进行解码，从而完成抓包操作

​	**以上方式使用了中间人攻击的方式来抓取HTTPS请求，只能应用于调试，不可应用于实际生产**



---------------------------------------



#### 发送HTTPS请求

​	这里以urllib3为例

urllib3会尝试加载系统的默认证书存储，然后对服务器的证书进行检查，从而建立安全连接

**也就是说，进行HTTPS请求默认不需要自行上传证书包**

​		如果你的应用程序主要在一个操作系统上运行，并且你相信该操作系统的证书管理是可信的，则使用系统的默认证书存储即可。

​		如果你的应用程序需要在不同的操作系统上运行，或者你希望更灵活地控制证书的版本和更新，那么建议使用其他根证书包

##### 上传证书包

​	urllib3需要在PoolManager级别启用证书验证并导入证书包

```python
http = urllib3.PoolManager(
    cert_reqs="CERT_REQUIRED",#指定对服务器证书的要求级别
    ca_certs=certifi.where() # 导入由Mozilla维护的根证书包，该证书包包含广泛受信任的证书
)
```

cert_reqs级别：

- CERT_NONE：不验证证书，接收任何证书

- CERT_OPTIONAL：可选验证服务器证书。如果服务器提供了证书，将验证证书的有效性，但如果没有提供证书，仍会建立连接。

- CERT_REQUIRED：必须验证服务器证书。如果服务器未提供有效的证书，将拒绝连接。

  

  **自1.25版本，urllib3默认cert_reqs = "CERT_REQUIRED"，即默认会对HTTPS请求进行证书检查**

  

---------------------------------------



#### 证书

##### 证书是什么

​	互联网上的证书通常是指SSL或其继任者TLS证书。这些证书用于加密和保护在网络上传输的数据，确保通信过程中的安全性和隐私性。

**简单来说，证书就像是网络世界的身份证，标识一个网络来确定一个网络的身份**



##### 证书的工作机制

​	在客户端与服务端建立HTTPS连接时，客户端会发出获取服务器证书的请求，服务器将其 SSL/TLS 证书发送给客户端。该证书包含了服务器的公钥、服务器的域名信息以及由证书颁发机构（CA）签名的信息。

**注：这里的客户端可以是浏览器、移动应用、桌面应用等**

​	然后客户端会检验证书的合法性，即颁发机构合法、时间有效、域名匹配（如果有一个不匹配就会发出警告）。在有些时候，浏览器也会要求客户端上传证书，多在银行等机构使用这种**双向认证**

​	证书验证通过后，继续进行，服务器与客户端连接继续，之后将会进行**生成会话密钥、使用公钥加密算法协商对称密钥**等步骤，最终建立了安全通信通道。



##### 证书安全

​	不要信任来历不明的证书
